<html><head><link rel="stylesheet" media="screen" href="coderay.css" type="text/css"></head><body><div class="CodeRay">
  <div class="code"><pre><span class="c"># Mocking a class method</span>

  product = <span class="co">Product</span>.new
  <span class="co">Product</span>.expects(<span class="sy">:find</span>).with(<span class="i">1</span>).returns(product)
  assert_equal product, <span class="co">Product</span>.find(<span class="i">1</span>)

<span class="c"># Mocking an instance method on a real object</span>

  product = <span class="co">Product</span>.new
  product.expects(<span class="sy">:save</span>).returns(<span class="pc">true</span>)
  assert product.save

<span class="c"># Stubbing instance methods on real object</span>

  prices = [stub(<span class="sy">:pence</span> =&gt; <span class="i">1000</span>), stub(<span class="sy">:pence</span> =&gt; <span class="i">2000</span>)]
  product = <span class="co">Product</span>.new
  product.stubs(<span class="sy">:prices</span>).returns(prices)
  assert_equal [<span class="i">1000</span>, <span class="i">2000</span>], product.prices.collect {|p| p.pence}

<span class="c"># Stubbing an instance method on all instances of a class</span>

  <span class="co">Product</span>.any_instance.stubs(<span class="sy">:name</span>).returns(<span class="s"><span class="dl">'</span><span class="k">stubbed_name</span><span class="dl">'</span></span>)
  product = <span class="co">Product</span>.new
  assert_equal <span class="s"><span class="dl">'</span><span class="k">stubbed_name</span><span class="dl">'</span></span>, product.name

<span class="c"># Traditional mocking</span>

  object = mock()
  object.expects(<span class="sy">:expected_method</span>).with(<span class="sy">:p1</span>, <span class="sy">:p2</span>).returns(<span class="sy">:result</span>)
  assert_equal <span class="sy">:result</span>, object.expected_method(<span class="sy">:p1</span>, <span class="sy">:p2</span>)

<span class="c"># Shortcuts</span>

  object = stub(<span class="sy">:method1</span> =&gt; <span class="sy">:result1</span>, <span class="sy">:method2</span> =&gt; <span class="sy">:result2</span>)
  assert_equal <span class="sy">:result1</span>, object.method1
  assert_equal <span class="sy">:result2</span>, object.method2</pre></div>
</div>
</body></html>